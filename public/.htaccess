Options -Indexes -MultiViews

<IfModule mod_rewrite.c>
  RewriteEngine On

  # Rewrite Next.js RSC dot-files to their folder form
  RewriteRule ^(.*/)?(__next\.[^./]+)\.__PAGE__\.txt$ $1$2/__PAGE__.txt [L]
  RewriteRule ^(.*/)?(__next\.[^./]+)\.([^/]+)\.__PAGE__\.txt$ $1$2/$3/__PAGE__.txt [L]
  RewriteRule ^(.*/)?(__next\.[^./]+)\.([^/]+)\.txt$ $1$2/$3.txt [L]

  # Redirect /path/index.html to /path/ for Next export assets
  RewriteCond %{THE_REQUEST} \s/+(.*/)?index\.html[\s?] [NC]
  RewriteRule ^(.*/)?index\.html$ /$1 [R=301,L]

  # Redirect to trailing slash when an index.html exists
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteCond %{REQUEST_FILENAME}/index.html -f
  RewriteRule ^(.+)$ /$1/ [R=301,L]

  # Serve existing files or directories as-is
  RewriteCond %{REQUEST_FILENAME} -f [OR]
  RewriteCond %{REQUEST_FILENAME} -d
  RewriteRule ^ - [L]
</IfModule>

ErrorDocument 404 /_not-found.html
